<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Renfe</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            var READY_STATE_COMPLETE=4;
            var peticion_http;
            
            function inicializa_xhr() {
                if(window.XMLHttpRequest) {
                    return new XMLHttpRequest();
                }else if(window.ActiveXObject) {
                    return new ActiveXObject("Microsoft.XMLHTTP");
                }
            }
            
            function cargarCiudades(){
                selectCiudades = document.getElementById("ciudades");
                selectCiudades.innerHTML= selectCiudadesOpcion1;
                selectMunicipios=document.getElementById("municipios");
                selectMunicipios.innerHTML=selectMunicipiosOpcion1;
                consultaCiudades();
            }
            
            var selectCiudadesOpcion1="<option value=\"\">-Selecciona-</option>";
            var selectMunicipiosOpcion1="<option value=\"\">-Selecciona-</option>";
            
            function consultaCiudades(){
                peticion_http=inicializa_xhr();
                if(peticion_http){
                    peticion_http.onreadystatechange = procesaCiudades;
                    peticion_http.open("GET","cargarProvincias.jsp",true);
                    peticion_http.send(null);
                }
            }
            
            function procesaCiudades(){
                if(peticion_http.readyState==READY_STATE_COMPLETE){
                    if(peticion_http.status==200){
                        var documento_xml = peticion_http.responseXML;
                        var root = documento_xml.getElementsByTagName("respuesta")[0];
                        var codigo=root.getElementsByTagName("codigo");
                        var ciudades=root.getElementsByTagName("ciudades");
                        for(var x=0;x<codigo.length;x++){
                            var opcion= "<option value=\"" +codigo[x].firstChild.nodeValue+"\">"+ciudades[x].firstChild.nodeValue+"</option>";
                            selectCiudades.innerHTML+=opcion;
                        }
                    }
                }
            }
            
            function cargaMunicipios(){
                peticion_http=inicializa_xhr();
                if(peticion_http){
                    peticion_http.onreadystatechange = procesaMunicipios;
                    peticion_http.open("POST","cargarMunicipios.jsp",true);
                    peticion_http.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                    var query_string = crea_query_string_municipios();
                    peticion_http.send(query_string);
                }
            }
            
            function crea_query_string_municipios(){
                var e=document.getElementById("ciudades");
                idc = e.options[e.selectedIndex].value;
                return "idc=" + encodeURIComponent(idc) +
                    "&nocache=" + Math.random();
            }
            
            function procesaMunicipios(){
                if(peticion_http.readyState==READY_STATE_COMPLETE){
                    if(peticion_http.status==200){
                        var documento_xml = peticion_http.responseXML;
                        var root = documento_xml.getElementsByTagName("respuesta")[0];
                        var codigo=root.getElementsByTagName("codigo");
                        var municipios=root.getElementsByTagName("municipios");
                        for(var x=0;x<codigo.length;x++){
                            var opcion= "<option value=\"" +codigo[x].firstChild.nodeValue+"\">"+municipios[x].firstChild.nodeValue+"</option>";
                            selectMunicipios.innerHTML+=opcion;
                        }
                    }
                }
            }
        </script>
        <style type="text/css">
           
        </style>
    </head>
    
    <body onload="cargarCiudades()">
        <table width="400" border="0" align="center" bgcolor="#ebf4fb" cellpadding="6">
            <tr>
                <td colspan="2" style="font-size: 15px"><b>RENFE</b></td>
            </tr>
            <tr>
                <td align="right">
                    <span style="font-size:13px"><b>Ciudades</b></span><br>
                    Selecciona una ciudad
                </td>
                <td>
                    <select id="ciudades" name="ciudades" onchange="cargaMunicipios()"></select>
                </td>
            </tr>
            <tr>
                <td align="right"><span style="font-size: 13px"><b>Municipios</b></span><br></td>
                <td>
                    <select id="municipios" name="municipios"></select> 
                </td>
            </tr>
            <tr>
                
                <td></td>
            </tr>
            <tr>
                <td colspan="2" id="peliculas">
                    
                </td>
            </tr>
        </table>      
    </body>
</html>
